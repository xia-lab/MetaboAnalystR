<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui">

    <h:form>
        <h:panelGrid style="padding: 30px 30px 20px 40px; font-size: 13px;  line-height: 23px; width: 95%">
            <h2>Parameter Setting</h2>
            <p>
                <b>Enrichment tests</b> are based on the well-established <a href="https://doi.org/10.1093/bioinformatics/btg382" target="_blank"><b>globaltest</b></a> to test associations between metabolite sets and the outcome. 
                The algorithm uses a generalized linear model to compute a ‘Q-stat’ for each metabolite set. The Q-stat is calculated as the average of the Q values calculated for 
                the each single metabolites; while the Q value is the squared covariance between the metabolite and the outcome. The globaltest has been shown to exhibit similar or superior performance when tested 
                against several other popular methods.
            </p>
            <p>
                <b>Metabolite sets</b>: Unlike transcriptomics which allows comprehensive gene expression profiling, targeted metabolomics usually covers only a small percentage of metabolome 
                (the actual coverage is platform/protocol specific). This means that metabolites (defined in our current pathways or metabolite sets) do not have equal probabilities 
                of being measured in your studies, and <u>the enriched functions are the results from both platform/protocol specific effects and biological perturbations</u>.
                Since the primary interest is to detect the latter, we highly recommend <b>uploading a reference metabolome</b> containing all measurable metabolites from 
                your platform to eliminate the former effects. 
            </p>
            <p:selectOneRadio id="msetLib" value="#{msetBean.msetOpt}" layout="custom">  

                <f:selectItem itemLabel="Pathway-associated metabolite sets (SMPDB)" itemValue="smpdb_pathway" />
                <f:selectItem itemLabel="Pathway-associated metabolite sets (KEGG)" itemValue="kegg_pathway" />
                <f:selectItem itemLabel="Pathway-associated metabolite sets (KEGG-2023)" itemValue="kegg_pathway_2023" />
                <f:selectItem itemLabel="Drug-pathway-associated metabolite sets" itemValue="drug" />
                <f:selectItem itemLabel="Pathway-associated metabolite sets (RaMP)" itemValue="RaMP_pathway" />
                <f:selectItem itemLabel="Pathway-associated metabolite sets (Lipid)" itemValue="lipid_pathway" />
                <f:selectItem itemLabel="Pathway-associated metabolite sets (GutBacteria)" itemValue="kegg_gutbac" />
                <f:selectItem itemLabel="Pathway-associated metabolite sets (GutBacteria+Host)" itemValue="kegg_gutbachsa" />

                <f:selectItem itemLabel="Disease-associated metabolite sets (Blood)" itemValue="blood" />
                <f:selectItem itemLabel="Disease-associated metabolite sets (Urine)" itemValue="urine" />
                <f:selectItem itemLabel="Disease-associated metabolite sets (CSF)" itemValue="csf" />
                <f:selectItem itemLabel="Disease-associated metabolite sets (Feces)" itemValue="fecal" />

                <f:selectItem itemLabel="Chemical class metabolite sets (Super-class)" itemValue="super_class" />
                <f:selectItem itemLabel="Chemical class metabolite sets (Main-class)" itemValue="main_class" />
                <f:selectItem itemLabel="Chemical class metabolite sets (Sub-class)" itemValue="sub_class" />  

                <f:selectItem itemLabel="SNP-associated metabolite sets" itemValue="snp" />
                <f:selectItem itemLabel="Exposure-based metabolite sets" itemValue="exposure" />                    
                <f:selectItem itemLabel="Predicted metabolite sets" itemValue="predicted" />
                <f:selectItem itemLabel="Location-based metabolite sets" itemValue="location" />

                <f:selectItem itemLabel="Self-defined metabolite sets" itemValue="self" />
            </p:selectOneRadio>

            <p:selectOneRadio id="refLib" value="#{msetBean.libOpt}" layout="custom">  
                <f:selectItem itemLabel="Use all the compounds in the selected metabolite set library" itemValue="all" />
                <f:selectItem itemLabel="Self-defined metabolome" itemValue="self" />
            </p:selectOneRadio>

            <h:panelGrid style="padding-left: 20px; width: 100%">
                <p:outputLabel style="font-weight: bold; font-size: 14px" value="Please select a metabolite set library"/>
                <p:panelGrid columns="2" layout="tabular" styleClass="myPanelGrid" style="width: 1000px;">

                    <h:panelGroup layout="block" style="width:150px">
                        <h:outputLabel style="font-weight: bold" value="Pathway based"/>
                    </h:panelGroup>

                    <h:panelGrid columns="3">
                        <p:radioButton for="msetLib" itemIndex="0"/>
                        <h:panelGroup layout="block" style="width:130px">
                            <h:outputLabel value="SMPDB"/>   
                        </h:panelGroup>
                        <h:outputText value="99 metabolite sets based on normal human metabolic pathways"/>  

                        <p:radioButton for="msetLib" itemIndex="1"/>
                        <h:outputLabel value="KEGG"/>
                        <h:outputText value="81 metabolite sets based on KEGG human metabolic pathways (Nov. 2025)"/>

                        <p:radioButton for="msetLib" itemIndex="2"/> <!-- To be retired -->
                        <h:outputLabel value="KEGG 2023"/>
                        <h:outputText value="80 metabolite sets based on KEGG human metabolic pathways (Dec. 2023) [Deprecated]"/>

                        <p:radioButton for="msetLib" itemIndex="3"/>
                        <h:outputLabel value="Drug related"/>
                        <h:outputText value="461 metabolite sets based on drug pathways from SMPDB."/>

                        <p:radioButton for="msetLib" itemIndex="4"/>
                        <h:outputLabel value="RaMP-DB"/>
                        <h:outputText value="3425 metabolite sets based on RaMP-DB pathways."/>

                        <p:radioButton for="msetLib" itemIndex="5"/>
                        <h:outputLabel value="Lipidomics"/>
                        <h:panelGroup>
                            817 entries integrating PathBank, Reactome, WikiPathways, and KEGG (Nov. 2025). 
                            (<a href='https://omicsforum.ca/t/what-are-the-metabolite-sets-for-lipidomics-functional-analysis-in-metaboanalyst/13484' target='_blank'>details</a>)
                        </h:panelGroup>

                        <p:radioButton for="msetLib" itemIndex="6"/>
                        <h:outputLabel value="Gut Bacteria"/>
                        <h:panelGroup>
                            123 entries based on KEGG metabolic pathways of common human gut bacteria  
                            (<a href='https://omicsforum.ca/t/what-is-the-human-gut-bacteria-kegg-pathway-set/13497' target='_blank'>details</a>)
                        </h:panelGroup>

                        <p:radioButton for="msetLib" itemIndex="7"/>
                        <h:outputLabel value="Gut Bacteria + Host"/>
                        <h:outputText value="139 KEGG pathways integrating human (host) and gut bacterial metabolism."/>
                    </h:panelGrid>


                    <h:outputLabel style="font-weight: bold" value="Disease signatures"/>

                    <h:panelGrid columns="3">
                        <p:radioButton for="msetLib" itemIndex="8"/>
                        <h:panelGroup layout="block" style="width:130px">
                            <h:outputLabel value="Blood"/>
                        </h:panelGroup>
                        <h:outputText value="480 metabolite sets reported in human blood."/>

                        <p:radioButton for="msetLib" itemIndex="9"/>
                        <h:outputLabel value="Urine"/>
                        <h:outputText value="385 metabolite sets reported in human urine."/>

                        <p:radioButton for="msetLib" itemIndex="10"/>
                        <h:outputLabel value="CSF"/>
                        <h:outputText value="174 metabolite sets reported in human cerebral spinal fluid (CSF)."/>

                        <p:radioButton for="msetLib" itemIndex="11"/>
                        <h:outputLabel value="Feces"/>
                        <h:outputText value="67 metabolite sets reported in human feces."/>
                    </h:panelGrid>


                    <h:outputLabel style="font-weight: bold" value="Chemcial structures"/>

                    <h:panelGrid columns="3">
                        <p:radioButton for="msetLib" itemIndex="12"/>
                        <h:panelGroup layout="block" style="width:130px">
                            <h:outputLabel escape="true" value="Super-class"/>   
                        </h:panelGroup>
                        <h:panelGroup layout="block">
                            <h:outputText value="39 super chemical class metabolite sets "/>
                            <font style="color: orange">or lipid sets</font>
                        </h:panelGroup>

                        <p:radioButton for="msetLib" itemIndex="13"/>
                        <h:outputLabel value="Main-class"/>
                        <h:panelGroup layout="block">
                            <h:outputText value="617 main chemical class metabolite sets "/>
                            <font style="color: orange">or lipid sets</font>
                        </h:panelGroup>

                        <p:radioButton for="msetLib" itemIndex="14"/>
                        <h:outputLabel value="Sub-class"/>
                        <h:panelGroup layout="block">
                            <h:outputText value="1250 sub chemical class metabolite sets "/>  
                            <font style="color: orange">or lipid sets</font>
                        </h:panelGroup>
                    </h:panelGrid>


                    <h:outputLabel style="font-weight: bold" value="Other types"/>
                    <h:panelGrid columns="3">
                        <p:radioButton for="msetLib" itemIndex="15"/>
                        <h:panelGroup layout="block" style="width:130px">
                            <h:outputLabel value="SNPs"/>
                        </h:panelGroup>
                        <h:outputText value="4,598 metabolite sets based on their associations with SNPs loci. "/>

                        <p:radioButton for="msetLib" itemIndex="16"/>
                        <h:outputLabel value="Exposure"/>
                        <h:outputText value="62 metabolite sets based on dietary and chemical exposures."/>   

                        <p:radioButton for="msetLib" itemIndex="17"/>
                        <h:outputLabel value="Predicted"/>
                        <h:outputText value="912 metabolic sets predicted to change in the case of dysfunctional enzymes."/>

                        <p:radioButton for="msetLib" itemIndex="18"/>
                        <h:outputLabel value="Locations"/>
                        <h:panelGroup layout="block">
                            <h:outputText value="78 metabolite "/>
                            <font style="color: orange">and lipid </font>
                            <h:outputText value="sets based on organ, tissue, and subcellular localizations."/>
                        </h:panelGroup> 
                    </h:panelGrid>

                    <h:outputLabel style="font-weight: bold" value="Self defined"/>
                    <h:panelGrid columns="3">
                        <p:radioButton for="msetLib" itemIndex="19"/>
                        <h:panelGroup layout="block" style="width:130px">
                            <p:commandLink value="Upload here" onclick="PF('msetUploadDialog').show()"/>
                        </h:panelGroup>
                        <h:outputText value="define your own customized metabolite sets"/>
                    </h:panelGrid>
                </p:panelGrid>

                <h:panelGrid style="padding-bottom: 10px" columns="3">
                    <p:selectBooleanCheckbox value="#{msetBean.doMsetFilter}" style="line-height: 18px"/>
                    <p:outputLabel value="Only use metabolite sets containing at least"/>
                    <p:selectOneMenu styleClass="menu" panelStyleClass="panel" value="#{msetBean.minMsetNum}">
                        <f:selectItem itemLabel="2 entries" itemValue="2" />
                        <f:selectItem itemLabel="3 entries" itemValue="3" />
                        <f:selectItem itemLabel="4 entries" itemValue="4" />
                        <f:selectItem itemLabel="5 entries" itemValue="5" />
                    </p:selectOneMenu>
                </h:panelGrid>

                <p:outputLabel style="font-weight: bold; font-size: 14px" value="Please specify a reference metabolome"/>
                <h:panelGrid columns="2" style="font-size: 13px; line-height: 23px; width: 1000px; padding: 20px; padding: 18px 15px 15px 21px;" 
                             class="surface-card shadow-1 p-4 text-800">
                    <p:radioButton for="refLib" itemIndex="0"/>
                    <h:outputLabel value="Use all the compounds in the selected library"/>

                    <p:radioButton for="refLib" itemIndex="1"/>
                    <p:commandLink value="Upload a reference metabolome based on your analytical platform" onclick="PF('libUploadDialog').show()"/>
                </h:panelGrid>

                <h:panelGrid style="width: 900px; text-align: center; padding-top: 10px">
                    <p:commandButton value="Submit" ajax="false" style="width:80px" rendered="#{!workflowBean.editMode}"
                                     onclick="PF('statusDialog').show()" 
                                     oncomplete="PF('statusDialog').hide()"                              
                                     action="#{msetBean.submitBtn_action()}"/>
                    <p:commandButton value="Submit" style="width:80px" rendered="#{workflowBean.editMode}"
                                     onclick="PF('statusDialog').show()" 
                                     oncomplete="PF('statusDialog').hide()"                              
                                     actionListener="#{msetBean.submitBtn_action()}"/>
                </h:panelGrid> 
            </h:panelGrid>
        </h:panelGrid>
    </h:form>


    <p:dialog widgetVar="msetUploadDialog" dynamic="true" modal="true" appendTo="@(body)" header="Metabolite Set Upload"
              hideEffect="explode" resizable="true">
        <h:panelGrid style="padding:0px 10px 20px 18px; font-size: 13px; line-height: 23px; width:480px;">
            <div style="padding-bottom: 20px">
                Your metabolite set library must be uploaded as a comma separated file format (.csv), max 10M.
                It must contain two columns: the first column is the metabolite set name, 
                and the second column is a list of compound names separated by "; " (a semicolon and a space). 
                An example subset of the pathway library can be found 
                <a href="https://www.xialab.ca/api/download/metaboanalyst/lib_example.csv">here</a>.
                The library must be comprehensive in order to get meaningful results.  
                Please note: all the metabolites must use compound names. You can use the 
                "ID Conversion" program from <b>Other Utilities</b> to standardize the names.
            </div>
            <h:form id="uploadForm" enctype="multipart/form-data">
                <p:fileUpload value="#{msetBean.msetLibFile}" mode="simple" skinSimple="true" 
                              style="line-height: 18px">
                    <p:validateFile sizeLimit="10485760"
                                    allowTypes="/(\.|\/)(csv|txt|tsv)$/"/>
                </p:fileUpload>  
                <p:commandButton value="Submit" ajax="false"
                                 style ="margin-left: 20px"
                                 onclick="PF('statusDialog').show()"
                                 oncomplete="PF('statusDialog').hide()"
                                 actionListener="#{msetBean.msetUploadBn_action()}"/>  
            </h:form>  
        </h:panelGrid>
    </p:dialog>

    <p:dialog widgetVar="libUploadDialog" dynamic="true" modal="true" appendTo="@(body)" header="Reference Metabolome Upload"
              hideEffect="explode" resizable="true">
        <h:panelGrid style="padding:0px 10px 20px 20px; font-size: 13px; line-height: 23px; width:480px;">
            <div style="padding-bottom: 20px">
                The reference metabolome refers to all the metabolites that can be detected based on your analytical platform. 
                They should be uploaded as a plain text file (.csv or .txt, max 10M) containing a single-column list of compound names. 
                You can use the "Compound ID Conversion" program 
                from "Other Utilities" to perform the name conversion. An example list can be found 
                <a href="#{facesContext.externalContext.requestContextPath}/resources/data/hmdb_list.txt">here</a>.
            </div>
            <h:form enctype="multipart/form-data">
                <p:fileUpload value="#{msetBean.metabolomeFile}" mode="simple" skinSimple="true" style="line-height: 18px">
                    <p:validateFile sizeLimit="10485760"
                                    allowTypes="/(\.|\/)(csv|txt|tsv)$/"/>
                </p:fileUpload>  
                <p:commandButton value="Submit" ajax="false"
                                 style ="margin-left: 20px"
                                 onclick="PF('statusDialog').show()"
                                 oncomplete="PF('statusDialog').hide()"
                                 actionListener="#{msetBean.uploadMetabolomeBn_action()}"/>  
            </h:form>  
        </h:panelGrid>      
    </p:dialog>
</ui:composition>
