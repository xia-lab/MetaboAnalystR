<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/template/_template_workflow.xhtml">
    <ui:define name="metaInfo">
        <f:event type="preRenderView" listener="#{sessionBean1.addNaviTrack('Upload', '/Secure/workflow/upload/StatUploadView.xhtml')}"/>
        <f:event type="preRenderView" listener="#{workflowBean.loadDefaultWorkflows()}"></f:event> 
    </ui:define>  
    <ui:define name="content">
        <style>
            /* Ensure the file upload button remains consistent in size */
            .file-upload-custom .ui-fileupload-button {
                width: 120px; /* Set a fixed width for the button */
                display: inline-block;
                white-space: nowrap;
            }

            /* Control the filename display to avoid shrinking */
            .file-upload-custom .ui-fileupload-filename {
                display: inline-block;
                /* Limit the filename display */
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                vertical-align: middle;
                padding-left: 10px; /* Add space between the button and the filename */
            }

            /* Style to adjust the overall file upload container */
            .file-upload-custom .ui-fileupload {
                display: inline-block;
                width: auto;
                vertical-align: middle;
            }

            /* Ensure the file upload input remains consistent */
            .file-upload-custom .ui-fileupload-choose {
                width: 200px; /* Same width for the button */
                height: 30px; /* Adjust the height if necessary */
            }

            .ui-inputtextarea:disabled {
                color: white !important; /* Set font color to white */
                background-color: #333333; /* Optionally, set a dark background for contrast */
                opacity: 1 !important; /* Remove dimming effect on the text */
            }

            .ui-tabs-nav li.ui-state-disabled {
                opacity: 1 !important;     /* Removes the dimmed appearance */
                pointer-events: none;      /* Ensures the tab remains unclickable */
                color: inherit;            /* Maintains original text color */
            }
        </style>
        <h:panelGrid styleClass="my-content-panel">
            <h:panelGroup id="mainId">
                <p:tabView widgetVar="tabWidget" activeIndex="#{workflowBean.activeIndex}">
                    <p:tab id="personal" title="Upload" disabled="true">

                    </p:tab>            

                    <p:tab id="namecheck" title="Integrity Check" disabled="true">

                    </p:tab>

                    <!--
                    <p:tab id="design" title="Workflow" disabled="true">
    
                    </p:tab>
                    -->
                </p:tabView>

                <h:panelGroup rendered="#{workflowBean.activeIndex eq 0}">
                    <h4>Please upload and process your data</h4>
                    <p>
                        Use the panel below to prepare each individual data. Click the individual cells to activate each process. Click <b>Add New</b> to add a new data set. 
                        The maximum total number of samples allowed is <b>1000</b>. When all data sets have been processed, 
                        Click <b>Proceed</b> to proceed. Click the <b>Try Examples</b> button to try our example datasets.
                    </p>
                    <h:form id="form" enctype="multipart/form-data">
                        <p:dataTable id="navipane" var="data" 
                                     class="surface-card shadow-1 p-0 text-800"
                                     value="#{pLoadBean.dataSets}">
                            <p:column headerText="Data Upload" style="width:140px; text-align: center">
                                <p:commandButton  update=":uploadView"
                                                  value="#{data.name}"
                                                  icon="#{data.uploadIcon}"
                                                  oncomplete="PF('uploader').show()">
                                    <f:setPropertyActionListener value="#{data}" target="#{pLoadBean.selectedData}"/>
                                </p:commandButton>
                            </p:column>

                            <p:column headerText="Integrity Check" style="width:130px; text-align: center">
                                <p:commandButton  update=":expView"
                                                  value="Process"
                                                  disabled="#{!data.uploaded}"
                                                  icon="#{data.processIcon}"
                                                  oncomplete="PF('procDialog').show()">
                                    <f:setPropertyActionListener value="#{data}" target="#{pLoadBean.data4Vis}"/>
                                </p:commandButton>
                            </p:column>

                            <p:column headerText="Normalization" style="width:130px; text-align: center">
                                <p:commandButton update=":normView :normDialogid"
                                                 value="Normalize"
                                                 disabled="#{!data.processed}"
                                                 icon="#{data.normIcon}"
                                                 oncomplete="PF('normDialog').show()">
                                    <f:setPropertyActionListener value="#{data}" target="#{pLoadBean.selectedData}"/>
                                </p:commandButton>
                            </p:column>

                            <p:column headerText="Analysis" style="width:130px; text-align: center">
                                <p:commandButton update=":analView"
                                                 value="Analyze"
                                                 disabled="#{!data.normed}"
                                                 icon="#{data.analIcon}"
                                                 oncomplete="PF('analDialog').show()">
                                    <f:setPropertyActionListener value="#{data}" target="#{pLoadBean.selectedData}"/>
                                </p:commandButton>
                            </p:column>

                            <p:column headerText="Summary" style="width:120px; text-align: center">
                                <p:commandButton  update=":summaryForm"
                                                  value="Detail"
                                                  disabled="#{!data.analDone}"
                                                  icon="#{data.summaryIcon}"
                                                  oncomplete="PF('summaryDialog').show()">
                                    <f:setPropertyActionListener value="#{data}" target="#{pLoadBean.selectedData}"/>
                                </p:commandButton>
                            </p:column>

                            <p:column headerText="Include" style="width:60px; text-align: center">
                                <p:selectBooleanCheckbox value="#{data.include}" disabled = "#{!data.disabledModify}" style="line-height: 18px">
                                    <p:ajax event="change"/>
                                </p:selectBooleanCheckbox>
                            </p:column>
                            <f:facet name="footer">
                                <p:outputPanel style="width:100%; text-align: right">  
                                    <p:commandButton value="Try Examples"
                                                     id="testBn" style="width:160px"
                                                     icon="pi pi-star"            
                                                     onclick="PF('testDataDialog').show();"/>
                                    <p:spacer style="width: 30px"/>
                                    <p:commandButton value="Add New"
                                                     style="width:120px; margin-left: 20px;"
                                                     icon="pi pi-plus-circle"
                                                     update=":form:navipane"
                                                     actionListener="#{pLoadBean.addData}"/>

                                </p:outputPanel>
                            </f:facet>
                        </p:dataTable>
                    </h:form>
                    <p:dialog widgetVar="uploader" header="Data Upload" dynamic="true" modal="true" appendTo="@(body)"
                              hideEffect="explode" resizable="true">
                        <h:panelGrid id="uploadView" style="width:540px; padding:2px 20px 20px 20px; line-height: 21px">
                            <p>
                                Please read <a href="/MetaboAnalyst/faces/docs/Format.xhtml" target="_blank">these instructions</a>
                                on how to format your data correctly. The maximum file size is <b>50M</b>. Only comma separated values (.csv) files
                                are accepted. Note that below you can upload peak tables (of the same study) from one or both ion modes.
                            </p>
                            <h:form id="uploadForm" enctype="multipart/form-data">

                                <h:panelGrid columns="2" style="width:100%">
                                    <p:outputLabel style="font-size:12px; font-weight: bold;" value="Format:"/>
                                    <p:selectOneMenu styleClass="menu" panelStyleClass="panel" value="#{pLoadBean.dataFormat}" style="width:220px">
                                        <f:selectItem itemLabel="Samples in columns" itemValue="colu"/>
                                        <f:selectItem itemLabel="Samples in rows" itemValue="rowu"/>
                                    </p:selectOneMenu>

                                    <p:outputLabel style="font-size:12px; font-weight: bold" value="Ion Mode:"/>
                                    <p:selectOneMenu styleClass="menu"
                                                     panelStyleClass="panel"
                                                     value="#{pLoadBean.dataIon}"
                                                     style="width:220px">
                                        <f:selectItem itemLabel="Positive" itemValue="positive"/>
                                        <f:selectItem itemLabel="Negative" itemValue="negative"/>
                                        <f:selectItem itemLabel="Both (Mixed)" itemValue="mixed"/>
                                        <p:ajax event="change"
                                                update="userMenuWrapper"/>
                                    </p:selectOneMenu>

                                    <h:outputLabel style="font-size:12px; font-weight: bold" value="Set mass tolerance ppm:"/>
                                    <p:inputText  value="#{pLoadBean.selectedData.ppm}" required="true"/>

                                    <h:outputLabel style="font-size:12px; font-weight: bold" value="Has Retention Time:"/>
                                    <p:selectOneMenu styleClass="menu" panelStyleClass="panel" 
                                                     value="#{pLoadBean.selectedData.mumRT}" style="width:160px">
                                        <f:selectItem itemLabel="No" itemValue="false"/>
                                        <f:selectItem itemLabel="Yes-Minutes" itemValue="minutes"/>
                                        <f:selectItem itemLabel="Yes-Seconds" itemValue="seconds"/>
                                    </p:selectOneMenu>
                                </h:panelGrid>

                                <h:panelGrid columns="2" id="userMenuWrapper">
                                    <p:outputLabel style="font-size:12px; font-weight: bold;"
                                                   value="Data File:"
                                                   id="regular"
                                                   rendered="#{pLoadBean.dataIon != 'mixed'}"/>
                                    <p:fileUpload value="#{pLoadBean.fileReg}"
                                                  style="width: 240px; padding-left: 132px; line-height: 18px"
                                                  mode="simple"  skinSimple="true"
                                                  id="regular2"
                                                  rendered="#{pLoadBean.dataIon != 'mixed'}"/>

                                    <p:outputLabel style="font-size:12px; font-weight: bold"
                                                   value="Positive File:"
                                                   id="positive"
                                                   rendered="#{pLoadBean.dataIon == 'mixed'}"/>
                                    <p:fileUpload value="#{pLoadBean.filePos}"
                                                  style="width: 240px; padding-left: 106px; line-height: 18px"
                                                  mode="simple"  skinSimple="true"
                                                  id="positive2"
                                                  rendered="#{pLoadBean.dataIon == 'mixed'}"/>

                                    <p:outputLabel style="font-size:12px; font-weight: bold"
                                                   value="Negative File:"
                                                   id="negative"
                                                   rendered="#{pLoadBean.dataIon == 'mixed'}"/>
                                    <p:fileUpload value="#{pLoadBean.fileNeg}"
                                                  style="width: 240px; padding-left: 106px; line-height: 18px"
                                                  mode="simple"  skinSimple="true"
                                                  id="negative2"
                                                  rendered="#{pLoadBean.dataIon == 'mixed'}"/>

                                </h:panelGrid>

                                <h:panelGrid style="width:100%; text-align: center; padding-top: 10px">
                                    <p:commandButton value="Submit" ajax="false"
                                                     style ="margin-left: 20px"
                                                     onclick="PF('statusDialog').show()"
                                                     oncomplete="PF('statusDialog').hide()"
                                                     actionListener="#{pLoadBean.handleFileUpload()}"/>
                                </h:panelGrid>
                            </h:form>
                        </h:panelGrid>
                    </p:dialog>

                    <p:dialog widgetVar="procDialog" dynamic="true" modal="true" appendTo="@(body)" header="Integrity Check"
                              hideEffect="explode" resizable="true">
                        <h:panelGrid id="expView" columns = "2" style="width:680px; height: 320px; padding: 10px">
                            <h:panelGrid style="border: 1px dashed black; padding: 10px; width: 320px" class="surface-card shadow-1 p-4 text-800">
                                <h:outputLabel value="#{pLoadBean.selectedData.msgText}" escape="false"/>
                            </h:panelGrid>
                            <h:panelGrid cellpadding="10" style="width: 300px">
                                <h:outputText style = "padding-left: 30px; padding-bottom: 0px" value="Data distribution of the peaks (max 100)"/>
                                <img onerror='this.style.display="none"' style="width: 300px; padding: 0px" src="#{pLoadBean.naiveDisPlot()}"/>
                            </h:panelGrid>
                        </h:panelGrid>
                        <h:panelGrid style="width:100%; text-align: center">
                            <p:commandButton value="Done"
                                             oncomplete="PF('procDialog').hide()"
                                             update=":form:navipane"/>
                        </h:panelGrid>
                    </p:dialog>

                    <p:dialog header="Data Normalization" widgetVar="normDialog" dynamic="true" modal="true" appendTo="@(body)" id ="normDialogid"
                              hideEffect="explode" resizable="true" position="#{pLoadBean.selectedData.diapos}">
                        <h:panelGrid id="normView" style="width:620px; padding: 0px 20px 10px 20px; line-height: 21px">
                            <p>
                                We suggest that all datasets should be compared at log scales with similar distributions.
                                You can use the <b>boxplots</b> (available in the previous step - data visualization plots) 
                                to help you determine if the data is already on the log scale. 
                            </p>
                            <h:form id="normForm">
                                <h:panelGrid id = "imagespad" columns = "#{pLoadBean.selectedData.modeNum}"
                                             style="width: 610px; text-align: center; padding: 0px; border: none">
                                    <p:graphicImage id = "update88"
                                                    style = "width: #{pLoadBean.width}" value="#{pLoadBean.image}"
                                                    rendered = "#{pLoadBean.selectedData.normed}" cache="false"/>
                                </h:panelGrid>

                                <p:panelGrid columns="2" style="width:100%">
                                    <h:panelGrid columns="2">
                                        <h:outputText value="Method:"/>
                                        <p:selectOneMenu id="normRB" value="#{pLoadBean.selectedData.normOpt}">
                                            <f:selectItem itemLabel="Log transform + Median Normalize" itemValue="logMed"/>
                                            <f:selectItem itemLabel="Log transform" itemValue="log"/>
                                            <f:selectItem itemLabel="None" itemValue="none"/>
                                        </p:selectOneMenu>
                                        <p:spacer/>
                                        <h:panelGroup layout="block" style="padding-top:5px">
                                            <p:selectBooleanCheckbox value="#{pLoadBean.selectedData.autoscaleOpt}" style="line-height: 18px"/>
                                            <h:outputText value="Perform auto-scaling" style="padding-left:10px"/>
                                        </h:panelGroup>
                                    </h:panelGrid>
                                    <h:panelGrid columns="1" style="padding: 20px">
                                        <p:commandButton value="Submit"
                                                         update="imagespad update88 :form:navipane normDialogid"
                                                         actionListener="#{pLoadBean.selectedData.performNormalization}"
                                                         onclick="PF('statusDialog').show();"                                         
                                                         oncomplete="PF('normDialog').show(); PF('statusDialog').hide();">
                                        </p:commandButton>
                                    </h:panelGrid>
                                </p:panelGrid>

                                <h:panelGrid style="width:100%; text-align: center">
                                    <p:commandButton value="Done"
                                                     oncomplete="PF('normDialog').hide()"
                                                     update=":form:navipane"/>
                                </h:panelGrid>
                            </h:form>
                        </h:panelGrid>
                    </p:dialog>

                    <p:dialog header="Data Analysis" widgetVar="analDialog" dynamic="true" modal="true" appendTo="@(body)" id ="analDialogid"
                              hideEffect="explode" resizable="true" position="#{pLoadBean.selectedData.diapos2}">
                        <h:panelGrid id="analView" style="width:500px; padding: 0px 20px 10px 20px; line-height: 21px">
                            <p>
                                T-tests will be performed on the uploaded peak table to determine the number of significant peaks. 
                                Note that the mummichog algorithm (Li et al. 2013) works best when there are 10~25% significant peaks.
                                The pie chart below shows the percentage of significant peaks in your dataset.        
                            </p>
                            <h:form id="analForm">
                                <h:panelGrid columns="2" style="width:420px; margin-left: 20px;">

                                    <h:outputLabel value="Set p value cutoff" style="font-size:12px; font-weight: bold"/>
                                    <p:inputText  value="#{pLoadBean.selectedData.sigLevel}" style = "width: 120px" required="true"/>
                                    <h:outputLabel value="Customize adducts (Optional):" style="font-size:12px; font-weight: bold"/>
                                    <p:commandLink value="Edit Adducts" onclick="PF('addDialog').show()"/>

                                    <h:outputLabel value="Species" rendered = "false"/>
                                    <p:inputText  value="#{pLoadBean.selectedData.sigLevel}" required="true" rendered = "false"/>
                                </h:panelGrid>
                                <h:panelGrid id="padding" style="padding-left: 90px; text-align: center;">
                                    <p:chart id="pie" rendered ="#{pLoadBean.selectedData.analDone}"
                                                value="#{pLoadBean.selectedData.pieModel}"
                                                style="width:300px;height:160px"/> 
                                </h:panelGrid>

                                <h:panelGrid columns="2" style="width:100%; text-align: center; padding-top: 20px;">
                                    <p:commandButton value="Submit"
                                                     onclick="PF('statusDialog').show()"
                                                     oncomplete="PF('statusDialog').hide(); PF('analDialog').show()"
                                                     actionListener="#{pLoadBean.selectedData.performPathAnalysis()}"
                                                     update=":form:navipane :analForm"/>

                                    <p:commandButton value="Done" id="padding2"
                                                     rendered ="#{pLoadBean.selectedData.analDone}"
                                                     oncomplete="PF('analDialog').hide()"
                                                     update=":form:navipane"/>
                                </h:panelGrid>
                            </h:form>
                        </h:panelGrid>
                    </p:dialog>

                    <p:dialog header="Adduct Customization" widgetVar="addDialog" showEffect="fade" hideEffect="fade" dynamic="true"
                              modal="true" closable="true" draggable="false" resizable="false"
                              appendTo="@(body)">
                        <h:panelGrid id="addView" style="width:360px; padding: 0px 20px 10px 20px; line-height: 21px">
                            <p> 
                                Please customize the adducts based on your experimental conditions (e.g. Mobile Phases). 
                                Click the <b>Confirm</b> button to finalize these changes.
                            </p>
                            <h:form>
                                <h:panelGrid style="padding: 10px; padding-left: 35px; width:420px; font-size: 13px; line-height: 23px">
                                    <p:pickList id="adductPane"
                                                value="#{pLoadBean.selectedData.adductItems}"
                                                var ="add" itemValue="#{add}" itemLabel="#{add}">
                                        <f:facet name="sourceCaption">Available</f:facet>
                                        <f:facet name="targetCaption">Include</f:facet>
                                        <p:ajax event="transfer" listener="#{pLoadBean.selectedData.doTransfer}"/>
                                    </p:pickList>

                                    <h:panelGrid style="width:100%; padding-right: 45px; padding-top: 10px; text-align: center">
                                        <p:commandButton value="Confirm" style="width:80px"
                                                         actionListener="#{pLoadBean.selectedData.defineAdducts}"
                                                         oncomplete="PF('addDialog').hide(); PF('summaryDialog').show()"/>
                                    </h:panelGrid>
                                </h:panelGrid>
                            </h:form>
                        </h:panelGrid>
                    </p:dialog>

                    <p:dialog header="Data Summary" widgetVar="summaryDialog" dynamic="true" modal="true" appendTo="@(body)"
                              hideEffect="explode" resizable="true" width="500px">

                        <h:form id="summaryForm">
                            <h:panelGrid columns="2" style="padding: 20px; line-height: 23px">
                                <h:outputLabel value="Data name:"/>
                                <h:outputLabel value="#{pLoadBean.selectedData.name}"/>
                                <h:outputLabel value="Number of features:"/>
                                <h:outputLabel value="#{pLoadBean.selectedData.geneNum}"/>
                                <h:outputLabel value="Number of samples:"/>
                                <h:outputLabel value="#{pLoadBean.selectedData.smplNum}"/>
                                <h:outputLabel value="Group labels:"/>
                                <h:outputLabel value="#{pLoadBean.selectedData.groupInfo}"/>
                                <h:outputLabel value="Normalization procedures used:"/>
                                <h:outputLabel value="#{pLoadBean.selectedData.normInfo}"/>
                                <h:outputLabel value="Percentage of signficant hits(%):"/>
                                <h:outputLabel value="#{pLoadBean.selectedData.deNum}"/>
                            </h:panelGrid>
                            <br/>
                            <h:panelGrid style="width:100%; text-align: center">
                                <p:commandButton value="Submit" id="okBn"
                                                 actionListener="#{pLoadBean.finishDataSet()}"
                                                 oncomplete="PF('summaryDialog').hide()"
                                                 update=":form:navipane"
                                                 icon="pi pi-check"/>
                            </h:panelGrid>
                        </h:form>
                    </p:dialog>

                    <p:dialog header="Confirmation"
                              widgetVar="checkDialog"
                              dynamic="true"
                              modal="true"
                              appendTo="@(body)"
                              onShow="PF('statusDialog').hide()"
                              hideEffect="explode"
                              resizable="false">
                        <h:panelGrid id="checkView" style="width:480px; text-align: center; padding: 20px;">
                            <h:form id="checkForm">
                                <h:panelGrid style = "margin: 0 auto;">
                                    <h:outputLabel style = "color: red; font-size: 17px" value="#{pLoadBean.integCheckMsg}" rendered="#{!pLoadBean.allowContinue}"/>
                                    <h:outputLabel style = "font-size: 16px" value="Have you uploaded all data and wish to continue?" rendered="#{pLoadBean.allowContinue}"/>
                                    <br/>
                                    <h:outputLabel style = "font-size: 16px" value="#{pLoadBean.integCheckMsg2}" escape="false"/>
                                </h:panelGrid>
                                <h:panelGrid columns="2" style="width:100%; padding-top: 20px">
                                    <p:commandButton value="Confirm" id="nextBn"
                                                     disabled="#{!pLoadBean.allowContinue}"
                                                     actionListener="#{wfUploadBean.confirmAllData()}"
                                                     oncomplete="PF('checkDialog').hide()"
                                                     update="mainId southform"/>
                                    <p:commandButton value="Cancel" id="okBn"
                                                     onclick="PF('checkDialog').hide()"/>
                                </h:panelGrid>
                            </h:form>
                        </h:panelGrid>
                    </p:dialog>


                    <p:dialog modal="true" widgetVar="testDataDialog"
                              style="line-height: 23px;" dynamic="true"
                              width="700px"
                              appendTo="@(body)" header="Example Datasets"
                              draggable="false" closable="false" resizable="true">
                        <h:form>
                            <p:selectOneRadio id="customRadio" value="#{pLoadBean.example}" layout="custom">
                                <f:selectItem itemValue="1"/>
                                <f:selectItem itemValue="2"/>
                            </p:selectOneRadio>
                            <p:panelGrid layout="tabular" columns="4" styleClass="myPanelGrid" class="surface-card shadow-1 p-4 text-800">
                                <h:panelGroup style="width:10px"></h:panelGroup>
                                <h:panelGroup style="font-weight: bold;">Datasets</h:panelGroup>
                                <h:panelGroup style="font-weight: bold; ">Description</h:panelGroup>
                                <h:panelGroup style="font-weight: bold; ">Data Type</h:panelGroup>

                                <h:panelGroup layout="block" style="width:10px">
                                    <p:radioButton for="customRadio" itemIndex="0"/>
                                </h:panelGroup>
                                <h:panelGrid style="width: 120px">
                                    <a href="https://www.xialab.ca/api/download/metaboanalyst/A1_pos.csv" target="_blank">Table A1</a><br/>
                                    <a href="https://www.xialab.ca/api/download/metaboanalyst/B1_pos.csv" target="_blank">Table B1</a><br/>
                                    <a href="https://www.xialab.ca/api/download/metaboanalyst/C1_pos.csv" target="_blank">Table C1</a><br/>
                                </h:panelGrid>
                                <h:panelGroup layout="block" style="width:200px">
                                    Three untargeted metabolomics datasets were obtained from a meta-analysis on COVID-19 by <a href="https://doi.org/10.3390/metabo11010044">Pang et al.</a>
                                </h:panelGroup>
                                <h:panelGroup layout="block" style="width:200px; font-size:12.5px">         
                                    Type: LC-MS, ESI<sup>+</sup><br/>
                                    Phenotype: COVID-19 vs. Healthy
                                </h:panelGroup>

                                <h:panelGroup style="width:10px">
                                    <p:radioButton for="customRadio" itemIndex="1"/>
                                </h:panelGroup>
                                <h:panelGrid columns="2">
                                    <h:panelGrid>
                                        <a href="https://www.xialab.ca/api/download/metaboanalyst/A1_pos.csv" target="_blank">A1 Pos</a><br/>
                                        <a href="https://www.xialab.ca/api/download/metaboanalyst/B1_pos.csv" target="_blank">B1 Pos</a><br/>
                                        <a href="https://www.xialab.ca/api/download/metaboanalyst/C1_pos.csv" target="_blank">C1 Pos</a><br/>
                                    </h:panelGrid>
                                    <h:panelGrid style="padding-left:20px">
                                        <a href="https://www.xialab.ca/api/download/metaboanalyst/A1_neg.csv" target="_blank">Neg</a><br/>
                                        <a href="https://www.xialab.ca/api/download/metaboanalyst/B1_neg.csv" target="_blank">Neg</a><br/>
                                        <a href="https://www.xialab.ca/api/download/metaboanalyst/C1_neg.csv" target="_blank">Neg</a><br/>
                                    </h:panelGrid>
                                </h:panelGrid>
                                <h:panelGroup>
                                    Three untargeted metabolomics datasets were obtained from a meta-analysis on COVID-19 by <a href="https://doi.org/10.3390/metabo11010044">Pang et al.</a>
                                </h:panelGroup>
                                <h:panelGroup>         
                                    Type: LC-MS, ESI<sup>+</sup> and ESI<sup>-</sup><br/>
                                    Phenotype: COVID-19 vs. Healthy
                                </h:panelGroup>
                            </p:panelGrid>
                            <h:panelGrid columns="2" style="width:670px; text-align: center; padding-top: 10px; padding-left: 50px">
                                <p:commandButton value="Submit"
                                                 onclick="PF('testDataDialog').hide();
                                                         PF('statusDialog').show()"
                                                 oncomplete="PF('statusDialog').hide()"
                                                 update=":form:navipane"
                                                 actionListener="#{wfUploadBean.doDefaultMetaPathAnalysis()}"/>
                                <p:commandButton value="Cancel" onclick="PF('testDataDialog').hide()" type="button"/>
                            </h:panelGrid>
                        </h:form>
                    </p:dialog>
                </h:panelGroup>

                <h:panelGroup rendered="#{workflowBean.activeIndex eq 1}">
                    <ui:include src="../process/_SanityCheck.xhtml" />
                </h:panelGroup>
            </h:panelGroup>

        </h:panelGrid>

    </ui:define>
    <ui:define name="myfooter">
        <h:form id="southform">
            <!-- Button set for "Upload" tab -->
            <p:outputPanel rendered="#{workflowBean.activeIndex == 0}">
                <h:panelGrid columns="2" style="width:100%; text-align: center; border-top: orange 2px groove; padding-top: 6px; padding-bottom: 4px">

                    <p:commandButton value="Back" style="width:160px"
                                     icon="pi pi-angle-double-left"
                                     update="southform mainId"
                                     action="WorkflowView"/>

                    <p:commandButton  style="width:150px;" 
                                      value="Proceed" 
                                      icon="pi pi-chevron-circle-right"
                                      onclick="PF('statusDialog').show()"
                                      actionListener="#{wfUploadBean.performMetaPathIntegrityCheck()}"
                                      update=":mainId"
                                      oncomplete="PF('checkDialog').show()"  
                                      />
                </h:panelGrid>

            </p:outputPanel>

            <p:outputPanel rendered="#{workflowBean.activeIndex == 1}">
                <h:panelGrid columns="3" style="width:100%; text-align: center; border-top: orange 2px groove; padding-top: 6px; padding-bottom: 4px">
                    <p:commandButton value="Back" style="width:160px"
                                     icon="pi pi-angle-double-left"
                                     update="southform mainId"
                                     actionListener="#{workflowBean.setActiveIndex(0)}"
                                     oncomplete="PF('tabWidget').select(0);"/>
                    <p:commandButton id="proc2ms" value="Proceed" style="width:160px"
                                     icon="pi pi-angle-double-right" 
                                     update="southform mainId"
                                     action="#{workflowBean.finishMultiPreparation('Peak Tables')}"
                                     />
                                                         <!--actionListener="#{wfUploadBean.skipButton_action_default(2)}"-->

                </h:panelGrid>
            </p:outputPanel>



            <p:outputPanel rendered="#{workflowBean.activeIndex == 2}">
                <h:panelGrid columns="3" style="width:100%; text-align: center; border-top: orange 2px groove; padding-top: 6px; padding-bottom: 4px">
                    <p:commandButton value="Back" style="width:160px"
                                     icon="pi pi-angle-double-left"
                                     update="southform mainId"
                                     actionListener="#{workflowBean.setActiveIndex(1)}"
                                     oncomplete="PF('tabWidget').select(2);"/>
                    <p:commandButton value="Finish"
                                     id="runAnalysisBn" style="width:160px"
                                     icon="pi pi-cog"       
                                     action="#{workflowBean.finishMultiPreparation('Peak Tables')}"
                                     update="southform mainId"
                                     />
                </h:panelGrid>
            </p:outputPanel>

        </h:form>

    </ui:define>
</ui:composition>
