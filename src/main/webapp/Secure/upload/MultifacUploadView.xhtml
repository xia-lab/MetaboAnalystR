<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="#{sessionBean1.templatePath}">
    <ui:define name="metaInfo">
        <f:event type="preRenderView" listener="#{sessionBean1.initNaviTree('mf')}"/>         
        <f:event type="preRenderView" listener="#{sessionBean1.addNaviTrack('Upload', '/Secure/upload/MultifacUploadView.xhtml')}"/>
    </ui:define>
    <ui:define name="footerout"/>
    <ui:define name="content">
        <h:form enctype="multipart/form-data">
            <h:panelGrid styleClass="my-content-panel">
                <h2>
                    Please upload your data and metadata
                </h2>
                <ul>
                    <li>
                        Data table contains compound concentrations or peak intensities for multiple samples;
                    </li>
                    <li>
                        Metadata table contains various descriptors of these samples and can be discrete or continuous;
                    </li>
                    <li>
                        Data and metadata tables must use the same sample IDs;
                    </li>
                    <li>
                        For detailed instructions, please visit our <a href="#{facesContext.externalContext.requestContextPath}/docs/Format.xhtml" target="_blank">Data Formats</a> 
                        page (under <b style="color:orange">Metadata/Time-series</b> tab) 
                    </li>
                </ul>
                <h:panelGroup id="formatIcon1">
                    <p:outputLabel style="font-size:13px; font-weight: bold" value="Plain text files (.csv/.txt):"/>
                    <p:spacer width="5px"/>
                    <i class="pi pi-info-circle"/>
                </h:panelGroup>
                <h:panelGrid columns="2" style="width:90%; padding: 20px; margin-bottom: 10px" class="surface-card shadow-1 p-4 text-800">
                    <h:panelGrid columns="2" cellpadding="5" style="width:600px; ">
                        <h:panelGroup layout="block" style="width:120px">
                            <p:outputLabel style="font-size:12px; font-weight: bold" value="Data Type:"/>
                        </h:panelGroup>
                        <p:selectOneRadio value="#{tsuploader.tsDataType}">
                            <f:selectItems value="#{optBean.tableTypeOpts}" />
                        </p:selectOneRadio>   

                        <p:outputLabel style="font-size:12px; font-weight: bold" value="Study Design:"/>
                        <p:selectOneMenu styleClass="menu" panelStyleClass="panel" value="#{sessionBean1.tsDesign}">
                            <f:selectItem itemValue="multi" itemLabel="Multiple factors / covariates"/>
                            <f:selectItem itemValue="time" itemLabel="Time-series + one factor"/>                            
                            <f:selectItem itemValue="time0" itemLabel="Time-series only"/>
                        </p:selectOneMenu> 

                        <p:outputLabel style="font-size:12px; font-weight: bold" value="Data Format:"/>
                        <p:selectOneMenu styleClass="menu" panelStyleClass="panel" style="width:165px" value="#{tsuploader.tsFormat}">
                            <f:selectItem itemValue="colmf" itemLabel="Samples in columns"/>    
                            <f:selectItem itemValue="rowmf" itemLabel="Samples in rows"/>                    
                        </p:selectOneMenu>

                        <p:outputLabel style="font-size:12px; font-weight: bold" value="Data File:"/>
                        <p:fileUpload value="#{tsuploader.csvFile}" mode="simple"  skinSimple="true" style="line-height: 18px"/>

                        <p:outputLabel style="font-size:12px; font-weight: bold" value="Metadata File:"/>
                        <p:fileUpload value="#{tsuploader.metaFile}" mode="simple"  skinSimple="true" style="line-height: 18px"/>
                    </h:panelGrid>

                    <p:commandButton value="Submit" 
                                     style="margin-left: 30px"
                                     onclick="PF('statusDialog').show()" 
                                     ajax="false" 
                                     action="#{tsuploader.handleTsDataUpload}"/>  

                </h:panelGrid>

                <h:panelGroup id="formatIcon3" layout="block" style="margin-top: 10px">
                    <p:outputLabel style="font-size:13px; font-weight: bold" value="An Excel file from Metabolon (.xlsx):"/>
                    <p:spacer width="5px"/>
                    <i class="pi pi-info-circle"/>
                </h:panelGroup>
                <h:panelGrid columns="2" style="width:90%; padding: 20px; margin-bottom: 10px;" class="surface-card shadow-1 p-4 text-800">
                    <h:panelGrid columns="2" cellpadding="5" style="width:600px; ">
                        <h:panelGroup layout="block" style="width:120px">
                            <p:outputLabel style="font-size:12px; font-weight: bold;" value="Data File:"/>
                        </h:panelGroup>
                        <h:panelGroup layout="block" style="width:480px">
                            <p:fileUpload value="#{tsuploader.metabolonFile}" 
                                          mode="simple" skinSimple="true" 
                                          style="line-height: 18px; padding-left: 10px; text-align: left;"/>
                        </h:panelGroup>
                    </h:panelGrid>

                    <p:commandButton value="Submit" ajax="false"
                                     style="margin-left: 30px"
                                     onclick="PF('statusDialog').show()" 
                                     oncomplete="PF('statusDialog').hide()"
                                     action="#{tsuploader.handleMetabolonData('mf')}"/>   

                </h:panelGrid>
                <p:tooltip for="formatIcon1" styleClass="helpTip">
                    <p>
                        Samples can be in either rows or columns. Both sample or feature names must be unique and consist of a combination of common English letters, underscores 
                        and numbers for naming purpose. Latin/Greek letters are not supported. The class labels must immediately follow sample names. 
                        Please visit our <b>Data Formats</b> page for more details.  
                    </p>    
                </p:tooltip>

                <p:tooltip for="formatIcon3" styleClass="helpTip">
                    <p>
                        Please upload the original XLSX datasheets from Metabolon directly without any editing or conversion.
                        Note that there are three sheets (<b>Chemical Annotation</b>, <b>Sample Meta Data</b> and <b>Peak Area Data</b>) required to proceed.                        
                    </p>    
                </p:tooltip>

               
                <hr class="style-one"/>
                <h2 style="margin-top: 20px; margin-bottom: 4px"> Try our test data</h2>
                <p:selectOneRadio id="timeRadio" value="#{tsuploader.timeDataOpt}" layout="custom">  
                    <f:selectItem itemValue="pkcovid" itemLabel="LC-MS peak intensity table"/>
                    <f:selectItem itemValue="tce" itemLabel="LC-MS peak intensity table"/>
                    <f:selectItem itemValue="time2" itemLabel="Time-series + one experimental factor"/>
                    <f:selectItem itemValue="time1" itemLabel="Time-series only"/>
                    <f:selectItem itemValue="diabetes" itemLabel="Lipidomics intensity table"/>
                    <f:selectItem itemValue="ewaste" itemLabel="LC-MS peak intensity table"/>
                    <f:selectItem itemValue="tce" itemLabel="LC-MS peak intensity table"/>

                </p:selectOneRadio> 

                <h:panelGrid columns="4" style="width: 900px; padding: 20px; background-color: #F9F9FB;">
                    <p:spacer style="width:30px"/>
                    <h:panelGroup layout="block" style="width:120px">
                        <p:outputLabel style="font-weight: bold" value="Data"/>
                    </h:panelGroup>       
                    <h:panelGroup layout="block" style="width:200px">
                        <p:outputLabel style="font-weight: bold" value="Study Design"/>
                    </h:panelGroup>   
                    <p:outputLabel style="font-weight: bold" value="Description"/>

                    <p:radioButton for="timeRadio" itemIndex="0"/> 
                    <h:panelGroup style="width:120px">
                        <a href="#{applicationBean1.apiResourcePath}covid_metabolomics_data.csv">Data</a>
                        <br />
                        <a href="#{applicationBean1.apiResourcePath}covid_metadata_multiclass.csv">Metadata</a>
                    </h:panelGroup>

                    <h:panelGroup layout="block" style="width:200px">
                        Multiple factors / covariates 
                    </h:panelGroup>
                    <h:panelGroup>
                        LC-MS peak intensity data table and meta-data of 20 healthy and 39 COVID-19 patient samples; 
                        <b>Four metadata</b> - 3 categorical and 1 numeric. 
                    </h:panelGroup>   

                    <p:radioButton for="timeRadio" itemIndex="1"/> 
                    <h:panelGroup style="width:120px">
                        <a href="#{applicationBean1.apiResourcePath}TCE_feature_table.csv">Data</a>
                        <br />
                        <a href="#{applicationBean1.apiResourcePath}TCE_metadata.csv">Metadata</a>
                    </h:panelGroup>

                    <h:panelGroup layout="block" style="width:200px">
                        Multiple factors / covariates 
                    </h:panelGroup>
                    <h:panelGroup>
                        LC-MS peak intensity data from plasma samples of 175 individuals to study 
                        trichloroethylene (TCE) exposure. <b>Nine metadata</b> - 6 categorical and 3 numeric. 
                        Please refer to <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5100622/">Walker D. et al</a> for more details.
                    </h:panelGroup>   

                    <p:radioButton for="timeRadio" itemIndex="2"/> 
                    <h:panelGroup style="width:120px">
                        <a href="#{applicationBean1.apiResourcePath}cress_time.csv">Data</a>
                        <br />
                        <a href="#{applicationBean1.apiResourcePath}cress_time_meta.csv">Metadata</a>
                    </h:panelGroup>
                    <h:panelGroup layout="block" style="width:200px">
                        Time series + one condition
                    </h:panelGroup>
                    <h:panelGroup>
                        LC-MS peak intensity data collected from <i>Arabidopsis thaliana</i> during a wounding time 
                        course (four time points). <b>WT</b> - wild type; <b>MT</b> - <i> dde2-2 </i>mutant. Please refer 
                        to (<a href="http://dx.doi.org/10.1186/1748-7188-3-9">Meinicke P. et al</a>) for more information
                    </h:panelGroup>

                    <p:radioButton for="timeRadio" itemIndex="3"/> 
                    <h:panelGroup style="width:120px">
                        <a href="#{applicationBean1.apiResourcePath}cress_time1.csv">Data</a>
                        <br />
                        <a href="#{applicationBean1.apiResourcePath}cress_time1_meta.csv">Metadata</a>                        
                    </h:panelGroup>
                    <h:panelGroup layout="block" style="width:200px">
                        Time series only data 
                    </h:panelGroup>
                    <h:panelGroup>
                        LC-MS peak intensity data collected from only <b>wild type</b> <i>Arabidopsis thaliana</i> during a wounding time 
                        course (four time points). Please refer to (<a href="http://dx.doi.org/10.1186/1748-7188-3-9">Meinicke P. et al</a>) for more information
                    </h:panelGroup>

                    <p:radioButton for="timeRadio" itemIndex="4"/> 
                    <h:panelGroup style="width:120px">
                        <a href="#{applicationBean1.apiResourcePath}diabetes_lipids.txt">Data</a>
                        <br />
                        <a href="#{applicationBean1.apiResourcePath}diabetes_metadata.csv">Metadata</a>                        
                    </h:panelGroup>
                    <h:panelGroup layout="block" style="width:200px">
                        Multiple factors / covariates 
                    </h:panelGroup>
                    <h:panelGroup>
                        Lipidomics data collected from plasma of patients along the spectrium of diabetes progression. <b>Five metadata</b> - 
                        1 categorical and 4 numeric. Please refer to <a href="https://www.nature.com/articles/s42255-021-00420-9" target="_blank">Wigger L. et al.</a> 
                        for more information.
                    </h:panelGroup>                    

                    <p:radioButton for="timeRadio" itemIndex="5"/> 
                    <h:panelGroup style="width:120px">
                        <a href="#{facesContext.externalContext.requestContextPath}/resources/data/ewaste_data_QC.csv">E-waste</a>
                        <br />
                        <a href="#{facesContext.externalContext.requestContextPath}/resources/data/ewaste_metadata.csv">Metadata</a>                        
                    </h:panelGroup>
                    <h:panelGroup layout="block" style="width:200px">
                        Multiple factors / covariates 
                    </h:panelGroup>
                    <h:panelGroup>
                        Exposomics data from e-waste workers exposed to heavy metals. The peak intensity table was generated with UPLC-Q/Exactive (C18 ESI-).
                    </h:panelGroup>  

                </h:panelGrid>
                <h:panelGrid style="width: 900px; padding-top: 10px; padding-bottom: 10px; text-align: center">
                    <p:commandButton value="Submit" 
                                     onclick="PF('statusDialog').show()" 
                                     ajax="false" 
                                     action="#{tsuploader.handleTestDataUpload}"/>  
                </h:panelGrid>
            </h:panelGrid>                    
        </h:form>


        <p:dialog modal="true" widgetVar="metabolondata" header="Metabolon datasets"
                  appendTo="@(body)" style="line-height: 23px;"
                  draggable="false" closable="true" resizable="true">            
            <div style="font-size:14px; font-weight: bold;">Please select one metadata factor and compound identifier:</div>
            <h:panelGrid style="padding: 20px">
                <h:form id="form1">
                    <h:panelGrid columns="2" style="padding: 10px 30px 20px 20px; line-height: 23px; width:500px" class="surface-card shadow-1 p-4 text-800">                        
                        <p:outputLabel style="font-size:13px; font-weight: bold" value="Compound ID: "/>
                        <p:selectOneMenu id="cID" value="#{tsuploader.defaultchemid}">
                            <f:selectItem itemLabel="Chemical Name" itemValue="CHEMICAL_NAME"/>
                            <f:selectItems value="#{tsuploader.metaboloneChemIDOpts}"/>
                        </p:selectOneMenu>
                    </h:panelGrid>

                    <h:panelGrid columns="2" style="width:500px; text-align: center; padding-top: 10px; padding-bottom: 20px">
                        <p:commandButton value="Confirm" ajax="false" style="width: 100px"
                                         onclick="PF('statusDialog').show()"
                                         action="#{tsuploader.processMetabolonData}"
                                         oncomplete="PF('statusDialog').hide();"/>   
                        <p:commandButton value="Cancel" ajax="false" style="width: 100px"
                                         onclick="PF('metabolondata').hide();" 
                                         oncomplete="PF('statusDialog').hide();" />   
                    </h:panelGrid> 
                </h:form>
            </h:panelGrid>            
        </p:dialog>

    </ui:define>
</ui:composition>
