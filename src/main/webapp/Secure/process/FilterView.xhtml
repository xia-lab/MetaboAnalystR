<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="#{sessionBean1.templatePath}"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <ui:define name="metaInfo">
        <f:event type="preRenderView" listener="#{sessionBean1.addNaviTrack('Data filter', '/Secure/process/FilterView.xhtml')}"/> 
        <f:event type="preRenderView" listener="#{procBean.prepareFilterView()}"/>  
    </ui:define>
    <ui:define name="footerout"/>
    <ui:define name="content">
        <h:panelGrid styleClass="my-content-panel">
            <h2>Data Filtering:</h2>
            <p>
                The purpose of the data filtering is to identify and remove variables that are unlikely to be of use 
                when modeling the data. No phenotype information are used in the filtering process, so the result 
                can be used with any downstream analysis. This step is strongly recommended for untargeted metabolomics 
                datasets (i.e. spectral binning data, peak lists) with large number of variables, many of them are from
                baseline noises. Filtering can usually improve the results. For details, please refer to the paper by  
                <a href='http://www.biomedcentral.com/1471-2105/10/11' target='_blank'>Hackstadt, et al</a>.
                Non-informative variables can be characterized in four groups:

                <ul>
                    <li>
                        <b>Low-quality filter</b> - exclude heavily contaminated features (based on BLANK samples), or features contain too many missing values. 
                    </li>
                    <li>
                        <b>Low-repeatability filter</b> - exclude features showing high percent RSD based on QC replicates (suggested 
                        threshold: 20% for LC-MS and 30% for GC-MS); 
                    </li>
                    <li>
                        <b>Low-variance filter</b> - exclude features that are near-constant across the experiment conditions - detected using different statistical measures of variance;
                    </li>
                    <li>
                        <b>Low-abundance filter</b> - exclude features are of very small values (close to baseline) - these 
                        variables can be detected using mean or median (useful when BLANK samples are unavailable). 
                    </li>
                </ul>
            </p>

            <h:form id="mainForm">
                <ui:include src="/Secure/workflow/process/_FilterView.xhtml" />
            </h:form>
        </h:panelGrid>

        <ui:include src="/template/_qc_rsd_dialog.xhtml" />

        <p:dialog widgetVar="missDialog" dynamic="true" modal="true" appendTo="@(body)" closable="true"
                  header="Missing Value Distributions"
                  hideEffect="explode" resizable="true" position="center"> 

            <p>
                <h:outputText value="#{procBean.missingMsg}" style="font-size: 14px; color:darkblue" escape="false"/>
            </p>

            <img onerror="this.style.display='none'"
                 src="#{sessionBean1.getCurrentImageURL('qc_miss')}"
                 alt="Missing-value lollipop plot"
                 style="width:7in;"/>

        </p:dialog>
    </ui:define>

    <ui:define name="myfooter">
        <h:form id="southform">
            <h:panelGrid columns="2" style="width:100%; text-align: center; border-top: orange 2px groove; padding-top: 6px; padding-bottom: 4px; padding-left: 10%; padding-right: 10%">
                <p:commandButton value="Submit" style="width:120px"
                                 onclick="PF('statusDialog').show()"
                                 oncomplete="PF('statusDialog').hide()"  
                                 process="mainForm @this"
                                 update=":hisTab:cmdPane"
                                 actionListener="#{procBean.filterButton_action()}"/>   
                <p:commandButton value="Proceed"  
                                 style="width:120px" 
                                 onclick="PF('statusDialog').show()"
                                 oncomplete="PF('statusDialog').hide()"
                                 ajax="false" 
                                 action="#{procBean.filterProceed_action()}"/> 
            </h:panelGrid>
        </h:form>
    </ui:define>
</ui:composition>
