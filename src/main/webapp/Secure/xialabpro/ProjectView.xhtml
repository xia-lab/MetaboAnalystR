<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/template/_template_workflow.xhtml">
    <ui:define name="metaInfo">
        <f:event type="preRenderView" listener="#{fireBaseController.initUserProjects()}"></f:event> 
        <f:event type="preRenderView" listener="#{sessionBean1.addNaviTrack('Projects', '/Secure/xialabpro/ProjectView.xhtml')}"/> 
    </ui:define>
    <ui:define name="mystyle">    
        <style>
            .warnHighlight {
                color: red !important;
            }

            .button-panel {
                width: 100%;
                padding: 2px;
                font-size: 13px;
                text-align:center;
            }


            .button-panel p:commandButton {
                margin: 0 20px;  /* Adjust the margin as needed */
            }

            /* Narrow column */
            .narrow-column {
                width: 35px; /* Adjust width as needed */
                text-align: right;
            }

            /* Wide column */
            .wide-column {
                text-align: left;
            }

            .row-selected {
                background: #FEF3C7 !important;   /* warm amber */
            }
            .row-selected > td {
                border-top: 1px solid #F59E0B;
                border-bottom: 1px solid #F59E0B;
            }

            /* Make all items appear “active” within this steps instance */
            #wfSteps .ui-steps-item .ui-menuitem-link {
                background: var(--primary-color, #3B82F6);
                border-color: var(--primary-color, #3B82F6);
                color: #fff;
            }
            #wfSteps .ui-steps-number {
                color:#fff;
            }
        </style>
    </ui:define>
    <ui:define name="myscript">
        <h:outputStylesheet library="css" name="dataset-cards.css"/>

        <link type="text/css" rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/resources/css/workflow.css" />

        <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/resources/jscripts/xialabpro/workflow_diagram.js"></script> 
        <script type="text/javascript">
            window.onload = function () {
                PF("workflowProgressDialog").hide();
                localStorage.removeItem('pagesToVisit');

                var reportEndBool = localStorage.getItem('reportEndBool');
                //console.log(reportEndBool + "=====reportEndBool");
                if (reportEndBool) {
                    //PF("resDialog").show();
                    PF('growlWidget').show([{severity: "info", summary: "INFO", detail: "Execution Finished! Click 'Dashboard' button to view results."}]);

                    localStorage.removeItem('reportEndBool');
                }

                //<![CDATA[
                function getURLParameter(name) {
                    return decodeURIComponent(
                            (new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')
                            ) || null;
                }
                //]]>
                if (getURLParameter('callFunc') !== null) {
                    checkPagesToVisit([]);
                }

            };

            (function () {
                window.onload = function () {
                    var shouldRun = #{datasetController.resetFlag ? 'true' : 'false'};
                    console.log(shouldRun);
                    console.log("shouldRun====");
                    var key = "afterResetRun";
                    if (shouldRun) {
                        setTimeout(function () {
                            afterResetCmd();
                        }, 200);
                    }
                };
            })();
            const POLL_MS = 45000;
            const pollTimer = setInterval(() => {
                try {
                    pingJob();
                } catch (e) {
                }
            }, POLL_MS);
        </script>

    </ui:define>
    <ui:define name="content">
        <h:form id="formHidden1">

            <p:remoteCommand name="afterResetCmd"
                             process="@this"
                             update=":acTab"
                             actionListener="#{datasetController.afterResetInit}" />
            <h:inputHidden id="domainUrl" value="#{applicationBean1.domainURL}" />
            <h:inputHidden id="analType" value="#{sessionBean1.analType}" />
            <h:inputHidden id="dataType" value="#{sessionBean1.dataType}" />
            <h:inputHidden id="funcArr" value="#{workflowBean.calledWorkflows}" />
            <h:inputHidden id="funcArrErr" value="#{workflowBean.calledWorkflowsError}" />
            <h:inputHidden id="libOpt" value="#{pathBean.libOpt}" />
            <h:inputHidden id="netVisMode" value="#{sessionBean1.visMode}" />
            <h:inputHidden id="naviType" value="#{sessionBean1.naviType}" />
            <h:inputHidden id="loggedIn" value="#{sessionBean1.loggedIn}" />
            <p:remoteCommand name="pingJob"
                             actionListener="#{jobExecution.checkJobStatus}"
                             update=":formHidden1 :formWorkflowInfo :formBell"/>
        </h:form>
        <h:panelGrid styleClass="my-content-panel">

            <p:growl id="msgs" showDetail="true" />

            <h2>
                Project Management
            </h2>
            <p>
                Your saved projects are shown below. 
                <ul>
                    <li>
                        Click <b>Project ID</b> to view / edit the details of the project;
                    </li>
                    <li>
                        Click <b>Load</b> to resume a saved project to continue analysis; Or click <b>Delete</b> to remove the project
                    </li>
                    <li>
                        Each project is associated with a live analysis report. Click <b>Report</b> to view or update the analysis report
                    </li>
                    <li>
                        Each project is associated with a workflow. You can analyze new data use a project-associated workflow. To do this, 
                        click the corresponding icon in <b>Workflow</b> column to extract and save the workflow into the workflow management page, 
                        and start using the workflow. 
                    </li>
                </ul>
            </p>
            <p:tabView widgetVar="tabWidget" id="acTab" style="margin: 20px; width:90%; border: none; font-size: 13px; line-height: 23px; min-height: 70vh" >
                <p:tab title ="Saved Projects">
                    <h:form id="projForm">
                        <p:outputLabel class="text-800 text-xl" value="#{fireProjectBean.checkProjectInfo()}" escape="false"/>  
                        <p:dataTable id="checkboxDT"
                                     var="project"
                                     value="#{fireProjectBean.projectTable}"
                                     rowKey="#{project.id}"
                                     paginator="true"
                                     rows="25" rowsPerPageTemplate="25,50,100"
                                     paginatorPosition="bottom"
                                     class="surface-card shadow-1 p-0 text-800"
                                     sortBy="#{project.id}"
                                     rowStyleClass="#{fireProjectBean.selectedProject ne null and project.id eq fireProjectBean.selectedProject.id ? 'row-selected' : ''}">


                            <p:column headerText="Project ID" style="text-align:center;" width="100px">
                                <p:commandLink value="#{project.id}" 
                                               oncomplete="PF('projectEditDialog').show();"
                                               update=":acTab:projForm :editDialogForm">
                                    <f:setPropertyActionListener value="#{project}" target="#{fireProjectBean.selectedProject}" />
                                </p:commandLink>

                            </p:column>

                            <p:column headerText="Title" width="15%"> 
                                <h:outputText value="#{project.title}" />
                            </p:column>

                            <p:column headerText="Type" width="30%">
                                <h:outputText
                                    value="#{project.projectType eq 'workflow'
                                             ? project.readableType.concat(' - Workflow')
                                             : project.readableType}" />
                            </p:column>

                            <p:column headerText="Last Updated" sortBy="#{project.creationDate}" width="120px">
                                <h:outputText value="#{project.creationDate}" />
                            </p:column>

                            <p:column headerText="Load" style="text-align:center; ">  
                                <p:commandLink value="" 
                                               id="loadBn"
                                               action="#{fireProjectBean.loadProjectOrShowDialog()}"
                                               update=":acTab:projForm :switchDialogForm :switchServerDialogForm"
                                               onclick="PF('statusDialog').show();"
                                               oncomplete="PF('statusDialog').hide();"
                                               >
                                    <i class="pi pi-arrow-circle-right" style="font-size: 1.4rem; color: orangered"></i>
                                    <f:setPropertyActionListener value="#{project}" target="#{fireProjectBean.projectToLoad}" />
                                </p:commandLink>
                            </p:column>

                            <p:column headerText="Resume" style="text-align:center;">  
                                <p:commandLink value="" 
                                               id="resumeBn"
                                               action="#{fireProjectBean.settingProceedType('resume')}"
                                               update=":acTab:projForm"
                                               disabled="#{!fireProjectBean.selectionFlag(project)}"
                                               onclick="PF('statusDialog').show();"
                                               oncomplete="PF('statusDialog').hide();"
                                               >
                                    <i class="pi pi-chevron-circle-right" style="font-size: 1.4rem; color: #2196F3"></i>
                                    <f:setPropertyActionListener value="#{project}" target="#{fireProjectBean.selectedProject}" />
                                </p:commandLink>
                            </p:column>

                            <p:column headerText="View" style="text-align:center;">  
                                <p:commandLink value="" 
                                               id="viewBn"
                                               action="#{fireProjectBean.settingProceedType('view')}"
                                               update=":acTab:projForm"
                                               disabled="#{!fireProjectBean.selectionFlag(project)}"
                                               onclick="PF('statusDialog').show();"
                                               oncomplete="PF('statusDialog').hide();"
                                               >
                                    <i class="pi pi-folder" style="font-size: 1.4rem; color: #2196F3"></i>
                                    <f:setPropertyActionListener value="#{project}" target="#{fireProjectBean.selectedProject}" />
                                </p:commandLink>
                            </p:column>
                            <p:column headerText="Report" style="text-align:center;">  
                                <p:commandLink value=""
                                               id="reportBn"
                                               action="#{fireProjectBean.settingProceedType('report')}"
                                               disabled="#{!fireProjectBean.selectionFlag(project)}"
                                               onclick="PF('statusDialog').show();"
                                               oncomplete="PF('statusDialog').hide();"
                                               >
                                    <i class="pi pi-file" style="font-size: 1.4rem; color: #2196F3"></i>
                                    <f:setPropertyActionListener value="#{project}" target="#{fireProjectBean.selectedProject}" />
                                </p:commandLink>
                            </p:column>
                            <!--
                            <p:column headerText="Transfer" style="text-align:center;" rendered="#{fireUserBean.adminUserBool}">  
                                <p:commandLink value=""
                                               id="transferBn"
                                               disabled="#{!fireProjectBean.selectionFlag(project)}"
                                               onclick="PF('transferDialog').show();"
                                               oncomplete="PF('statusDialog').hide();"
                                               >
                                    <i class="pi pi-arrow-up-right" style="font-size: 1.4rem; color: #2196F3"></i>
                                    <f:setPropertyActionListener value="#{project}" target="#{fireProjectBean.selectedProject}" />
                                </p:commandLink>
                            </p:column>
                            -->
                            <p:column headerText="Workflow" style="text-align:center;">  
                                <p:commandLink value=""
                                               id="transferBn"
                                               onclick="PF('workflowDialog').show();"
                                               >
                                    <i class="pi pi-arrow-up-right" style="font-size: 1.4rem; color: #2196F3"></i>
                                    <f:setPropertyActionListener value="#{project}" target="#{fireProjectBean.selectedProject}" />
                                </p:commandLink>
                            </p:column>

                            <p:column headerText="Delete" style="text-align:center;"> 
                                <p:commandLink value="" id="delActBn" onclick="PF('projectDelDialog').show();">
                                    <i class="pi pi-trash" style="font-size: 1.4rem; color: orangered"></i>
                                    <f:setPropertyActionListener value="#{project}" target="#{fireProjectBean.selectedProject}" />
                                </p:commandLink>
                            </p:column>
                        </p:dataTable>
                    </h:form>
                </p:tab>
                <p:tab title ="Workflow Runs">

                    <h:form id="workForm">
                        <!-- Steps with tooltips -->
                        <p:steps styleClass="mb-3">
                            <p:menuitem id="stepDataset" value="Dataset" icon="pi pi-database"
                                        title="Choose the input files and metadata."  styleClass="ui-state-highlight"/>
                            <p:menuitem id="stepWorkflow" value="Workflow" icon="pi pi-sitemap"
                                        title="Pick a template and parameters to run." styleClass="ui-state-highlight"/>
                            <p:menuitem id="stepResult" value="Result" icon="pi pi-wallet"
                                        title="View analysis results, figures, and downloadable outputs." styleClass="ui-state-highlight"/>
                        </p:steps>

                        <p:tooltip for="stepDataset" showEffect="fade" position="top" />
                        <p:tooltip for="stepWorkflow" showEffect="fade" position="top" />
                        <p:tooltip for="stepResult"  showEffect="fade" position="top" />

                        <p:panel styleClass="surface-card p-3 mb-3 shadow-1 border-round">
                            <div class="flex align-items-start gap-3">
                                <i class="pi pi-info-circle text-600" style="font-size:1.2rem"></i>
                                <div>
                                    <div class="text-900 font-medium mb-1">What is a workflow run?</div>
                                    <div class="text-700 text-sm">
                                        A run bundles a <b>Dataset</b> you provide, a <b>Workflow</b> you configure,
                                        and the generated <b>Result</b> files (plots, tables, and JSON/ZIP exports).
                                    </div>
                                    <ul class="mt-2 pl-3 text-700 text-sm" style="line-height:1.6;">
                                        <li><b>Dataset</b> – input matrix + metadata used for analysis.</li>
                                        <li><b>Workflow</b> – the steps/parameters applied (e.g., filtering → normalization → DE → enrichment).</li>
                                        <li><b>Result</b> – outputs you can preview, download, or re-run with tweaked settings.</li>
                                    </ul>
                                </div>
                            </div>

                            <p:divider class="my-3" />

                        </p:panel>
                        <p:outputLabel class="text-800 text-xl" value="#{fireProjectBean.checkProjectInfo()}" escape="false"/>  
                        <p:dataTable id="runsDT"
                                     var="run"
                                     value="#{fireProjectBean.workflowRunsTable}"
                                     rowKey="#{run.id}"
                                     paginator="true"
                                     rows="25" rowsPerPageTemplate="25,50,100"
                                     paginatorPosition="bottom"
                                     class="surface-card shadow-1 p-0 text-800"
                                     sortBy="#{run.id}"
                                     rowStyleClass="#{fireProjectBean.selectedWorkflowRun ne null and run.id eq fireProjectBean.selectedWorkflowRun.id ? 'row-selected' : ''}">

                            <p:column headerText="Run ID" style="text-align:center;" width="100px">
                                <p:commandLink value="#{run.id}"
                                               oncomplete="PF('runEditDialog').show();"
                                               update=":acTab:workForm :runEditDialogForm">
                                    <f:setPropertyActionListener value="#{run}" target="#{fireProjectBean.selectedWorkflowRun}" />
                                </p:commandLink>
                            </p:column>

                            <p:column headerText="Name" width="10%">
                                <h:outputText value="#{run.name}" />
                                <h:panelGroup rendered="#{empty run.name}">
                                    <h:outputText value="#{run.workflowId}" styleClass="text-600" />
                                </h:panelGroup>
                            </p:column>

                            <p:column headerText="Module" width="10%">
                                <h:outputText value="#{run.module}" />
                            </p:column>

                            <p:column headerText="Dataset" width="10%">
                                <h:outputText value="#{run.datasetName}" />
                            </p:column>

                            <p:column headerText="Status">
                                <!-- normalize to lowercase once and compare -->
                                <h:panelGroup rendered="#{run.status eq 'pending' or run.status eq 'Pending'}">
                                    <span class="mr-4">
                                        <i class="pi pi-hourglass text-orange-500" style="vertical-align:middle;"></i>
                                        <span class="ml-1">Pending</span>
                                    </span>
                                </h:panelGroup>

                                <h:panelGroup rendered="#{run.status eq 'running' or run.status eq 'Running'}">
                                    <span class="mr-4">
                                        <i class="pi pi-spinner pi-spin text-blue-500" style="vertical-align:middle;"></i>
                                        <span class="ml-1">Running</span>
                                    </span>
                                </h:panelGroup>

                                <h:panelGroup rendered="#{run.status eq 'completed' or run.status eq 'Completed'}">
                                    <span class="mr-4">
                                        <i class="pi pi-check-circle text-green-500" style="vertical-align:middle;"></i>
                                        <span class="ml-1">Completed</span>
                                    </span>
                                </h:panelGroup>

                                <h:panelGroup rendered="#{run.status eq 'failed' or run.status eq 'Failed'}">
                                    <span class="mr-4">
                                        <i class="pi pi-times-circle text-red-500" style="vertical-align:middle;"></i>
                                        <span class="ml-1">Failed</span>
                                    </span>
                                </h:panelGroup>
                            </p:column>

                            <p:column headerText="Last Updated" sortBy="#{run.lastUpdated}" width="160px">
                                <h:outputText value="#{run.lastUpdated}" />
                            </p:column>

                            <p:column headerText="Start" style="text-align:center;">
                                <p:commandLink id="startBn"
                                               update="formWorkDoc"
                                               oncomplete="PF('workStartDialog').show();">
                                    <i class="pi pi-arrow-circle-right" style="font-size:1.4rem; color: orangered"></i>
                                    <f:setPropertyActionListener value="#{run}" target="#{fireProjectBean.selectedWorkflowRun}" />
                                </p:commandLink>
                            </p:column>

                            <p:column headerText="Delete" style="text-align:center;">
                                <p:commandLink id="delRunBn" onclick="PF('runDelDialog').show();">
                                    <i class="pi pi-trash" style="font-size:1.4rem; color:orangered"></i>
                                    <f:setPropertyActionListener value="#{run}" target="#{fireProjectBean.selectedWorkflowRun}" />
                                </p:commandLink>
                            </p:column>

                        </p:dataTable>
                    </h:form>

                </p:tab>
            </p:tabView>
        </h:panelGrid>

        <p:dialog widgetVar="projectDelDialog" dynamic="true" modal="true" 
                  header="Delete Project"
                  appendTo="@(body)" onShow="PF('statusDialog').hide()"
                  hideEffect="fade" resizable="true"> 

            <h:form>
                <h:panelGrid  style="width:400px; line-height: 150%; padding: 10px; font-size: 14px">
                    <h:panelGrid columns="2" style="width:100%;" cellspacing="10">
                        <h:panelGroup>
                            <i class="pi pi-exclamation-circle" style="font-size:48px;color:red"></i>
                        </h:panelGroup>
                        <h:panelGroup>
                            Once deleted, a project cannot be recovered. Are you sure to delete this project?
                        </h:panelGroup>
                    </h:panelGrid>
                    <h:panelGrid columns="2" style="text-align: center; width:100%;">
                        <p:commandButton value="Cancel" id="okBn"
                                         onclick="PF('projectDelDialog').hide()"/>   
                        <p:commandButton value="Yes, delete" style="width:120px;"
                                         id="delBn"
                                         onclick="PF('statusDialog').show();"
                                         action="#{fireProjectBean.callProjectDelete()}"
                                         ajax="false"
                                         update=":acTab:projForm:checkboxDT"
                                         oncomplete ="PF('statusDialog').hide(); PF('projectDelDialog').hide()"
                                         />
                    </h:panelGrid>
                </h:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog header="Update Project Info" widgetVar="projectEditDialog" dynamic="true" modal="true" appendTo="@(body)" onShow="PF('statusDialog').hide()"
                  hideEffect="explode" resizable="true"> 
            <h:form id="editDialogForm"> 
                <h:panelGrid style="padding:10px; width:420px;"> 
                    <h:panelGrid style="width: 100%;" class="surface-card shadow-1 p-4 text-800">
                        <p:outputLabel for="title" value="Title" style="font-weight: bold;"/>
                        <p:inputText id="title" value="#{fireProjectBean.selectedProject.title}" style="width: 100%"/>

                        <p:outputLabel for="description" value="Description"  style="font-weight: bold;"/>
                        <p:inputTextarea id="description" value="#{fireProjectBean.selectedProject.description}" 
                                         rows="8" cols="48"/>

                    </h:panelGrid>

                    <h:panelGrid columns="2" style="width:100%; text-align: center">
                        <p:commandButton value="Cancel" id="okBn"
                                         onclick="PF('volcanoDialog').hide()"/>   
                        <p:commandButton id="facBn" value="Update" style="width:80px" ajax="false"
                                         onclick="PF('statusDialog').show();"
                                         action="#{fireProjectBean.updateProjectInfo}"
                                         styleClass="procBn"
                                         /> 
                    </h:panelGrid>
                </h:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog modal="true" widgetVar="Manager Entry" 
                  style="width: 400px; height:400px;" 
                  appendTo="@(body)" header="Administrator Entry:"
                  draggable="false" closable="true" resizable="false"> 
            <h:form id="formkill">

                <h:panelGrid>
                    <h:panelGrid columns="2" style="width:300px; padding-bottom:50px; margin-left: 70px;">
                        <h:outputLabel value="Password:"/>
                        <p:password value="#{JobManagerBean.killPassword}" style="width:120px" />    
                    </h:panelGrid>
                    <h:panelGrid columns="2" style="width:400px; text-align: center;">
                        <p:commandButton value="Cancel"
                                         onclick="PF('Manager Entry').hide();"
                                         />
                        <p:commandButton value="Confirm"
                                         action="#{JobManagerBean.enterManager()}"
                                         />
                    </h:panelGrid>
                </h:panelGrid>

            </h:form>
        </p:dialog>

        <p:dialog header="Switch Project Dialog"
                  widgetVar="switchProjDialog"
                  showEffect="fade"
                  hideEffect="fade"
                  modal="true"
                  width="580"
                  height="180"
                  closable="true"
                  draggable="false"
                  resizable="false"
                  appendTo="@(body)">
            <h:form id="switchDialogForm">
                <h:panelGrid  style="width:500px; line-height: 150%; padding: 2px; font-size: 13px">
                    <p>
                        <span icon="pi pi-info-circle" style="float:left; margin:0 7px 50px 0;"></span>
                        <div>You are about to access another project: <b>Project #{fireProjectBean.projectToLoad.getId()}</b>. Your current project's progress may be lost!</div>
                    </p>
                    <p>Please choose one of the following options:</p>
                </h:panelGrid>
                <h:panelGrid columns="2" styleClass="button-panel" style="width:100%; text-align:center">
                    <p:commandButton style="width:100px; font-size: 13px;" value="Cancel"
                                     onclick="PF('switchProjDialog').hide()"/>

                    <p:commandButton style="width:100px; font-size: 13px;" value="Proceed"
                                     onclick="PF('switchProjDialog').hide();PF('statusDialog').show();"
                                     action="#{fireProjectBean.settingProceedType('load')}"
                                     update=":acTab:projForm"
                                     oncomplete ="PF('statusDialog').hide();"/>
                </h:panelGrid>

            </h:form>
        </p:dialog>

        <p:dialog header="Switch Server Dialog"
                  widgetVar="switchServerDialog"
                  showEffect="fade"
                  hideEffect="fade"
                  modal="true"
                  width="580"
                  height="180"
                  closable="true"
                  draggable="false"
                  resizable="false"
                  appendTo="@(body)">
            <h:form id="switchServerDialogForm">
                <h:panelGrid  style="width:500px; line-height: 150%; padding: 2px; font-size: 13px">
                    <p>
                        <span icon="pi pi-info-circle" style="float:left; margin:0 7px 50px 0;"></span>
                        <div>You are about to access a project located on another server: <b>Project #{fireProjectBean.projectToLoad.getId()}</b>. Your current project's progress may be lost and this may take a while!</div>
                    </p>
                    <p>Please choose one of the following options:</p>
                </h:panelGrid>
                <h:panelGrid columns="2" styleClass="button-panel" style="width:100%; text-align:center">
                    <p:commandButton style="width:100px; font-size: 13px;" value="Cancel"
                                     onclick="PF('switchServerDialog').hide()"/>

                    <p:commandButton style="width:100px; font-size: 13px;" value="Proceed"
                                     onclick="PF('switchServerDialog').hide();PF('statusDialog').show();"
                                     action="#{fireProjectBean.settingProceedType('load')}"
                                     oncomplete="PF('statusDialog').hide();"
                                     update=":acTab:projForm" />
                </h:panelGrid>

            </h:form>
        </p:dialog>

        <p:dialog header="You are about to log off!"
                  widgetVar="logoutProjDialog"
                  showEffect="fade"
                  hideEffect="fade"
                  modal="true"
                  width="580"
                  height="180"
                  closable="true"
                  draggable="false"
                  resizable="false"
                  appendTo="@(body)">
            <h:form>
                <h:panelGrid  style="width:500px; line-height: 150%; padding: 2px; font-size: 13px">
                    <p>
                        <span icon="pi pi-info-circle" style="float:left; margin:0 7px 50px 0;"></span>
                        <div>You are about to log off. Your current progress will be save automatically! If you want to modify any settings, welcome back!</div>
                    </p>
                    <p>Please choose one of the following options:</p>
                </h:panelGrid>
                <p:commandButton style="width:160px; font-size: 13px; margin-left: 20%; margin-right: 0px" value="Save and log off"
                                 onclick="PF('logoutProjDialog').hide();PF('statusDialog').show();"
                                 action="#{projCtrl.saveProject()}"
                                 oncomplete ="PF('statusDialog').hide();"/>

                <p:commandButton style="width:160px; font-size: 13px; margin-left: 20px" value="Keep staying here"
                                 onclick="PF('logoutProjDialog').hide()"/>
            </h:form>
        </p:dialog>


        <p:dialog header="Transfer Project" widgetVar="transferDialog" dynamic="true" modal="true" appendTo="@(body)" onShow="PF('statusDialog').hide()"
                  hideEffect="explode" resizable="true"> 
            <h:form id="transferForm"> 
                <h:panelGrid style="padding-left:20px; width:350px; height:120px;"> 
                    <h:panelGrid columns="2" style="width: 360px">
                        <p:outputLabel for="title" value="Destination Email" style="font-weight: bold;"/>
                        <p:inputText id="title" value="#{fireProjectBean.destEmail}" style="width: 209px"/>


                    </h:panelGrid>

                    <h:panelGrid columns="2" style="padding-left:20px; width:350px;">
                        <p:commandButton value="Cancel" id="okBn"
                                         onclick="PF('volcanoDialog').hide()"/>   
                        <p:commandButton id="facBn" value="Update" style="width:80px" ajax="false"
                                         onclick="PF('statusDialog').show();"
                                         action="#{fireProjectBean.transferProject}"
                                         styleClass="procBn"
                                         /> 
                    </h:panelGrid>
                </h:panelGrid>
            </h:form>
        </p:dialog>


        <p:dialog header="Start Workflow based on selected project" widgetVar="workflowDialog" dynamic="true" modal="true" appendTo="@(body)" onShow="PF('statusDialog').hide()"
                  hideEffect="explode" resizable="true"> 
            <h:form id="workflowForm"> 
                <h:panelGrid style="padding-left:20px; width:350px; height:120px;"> 
                    <h:panelGrid columns="1" style="width: 360px">
                        <p>
                            You are about to start an automated workflow based on the template of selected project: #{fireProjectBean.selectedProject.id}
                        </p>
                        <p>
                            You can choose to use parameters from your project or default ones.
                        </p>
                    </h:panelGrid>
                    <h:panelGrid columns="2" style="padding-left:20px; width:350px;">
                        <h:panelGroup layout="block">
                            <h:outputLabel style="font-weight: bold" value="Parameters:"/> <br/>
                        </h:panelGroup>
                        <p:selectOneRadio layout="pageDirection" value="#{workflowBean.reloadingParameters}">
                            <f:selectItem itemLabel="Saved" itemValue="saved" /> 
                            <f:selectItem itemLabel="Default" itemValue="default" /> 
                        </p:selectOneRadio>
                    </h:panelGrid>

                    <h:panelGrid columns="2" style="padding-left:20px; width:350px;">
                        <p:commandButton value="Cancel" 
                                         onclick="PF('workflowDialog').hide()"/>   
                        <p:commandButton value="Confirm" style="width:80px" ajax="false"
                                         onclick="PF('statusDialog').show();"
                                         action="#{diagramView.initWorkflowBasedOnProject}"
                                         styleClass="procBn"
                                         /> 
                    </h:panelGrid>
                </h:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog modal="true" widgetVar="workStartDialog" 
                  style="width: 400px; " 
                  dynamic="true"
                  header="Start a workflow run:" 
                  appendTo="@(body)" 
                  draggable="false" closable="true" resizable="false"> 
            <h:form id="formWorkDoc">
                <h:panelGrid  style="width:100%; line-height: 25px; padding: 10px 20px 20px 20px; font-size: 13px"  class="surface-card shadow-0 p-3 text-600"> 
                    <h:panelGrid columns="2" style="width:100%">
                        <h:outputLabel value="Project Title"/>
                        <p:inputText id="float-input" style="width:100%" value="#{fireBaseController.fireDocName}"/>
                        <h:outputLabel value="Description"/>
                        <p:inputTextarea rows="10" cols="36" value="#{fireBaseController.fireDocDescription}"/>
                        <h:outputLabel value="Save:"/>
                        <h:panelGrid columns="2" style="width:100%">
                            <p:selectBooleanCheckbox value="#{fireBaseController.saveDataBoolean}" 
                                                     itemLabel="Dataset"/>
                            <p:selectBooleanCheckbox value="#{fireBaseController.saveWorkflowBoolean}" 
                                                     itemLabel="Workflow"/>
                        </h:panelGrid>
                    </h:panelGrid>
                    <h:panelGrid style=" text-align: center; padding-top:10px;width:100%">
                        <p:commandButton value="Save"
                                         actionListener="#{workflowBean.startRun()}"
                                         onclick="PF('workStartDialog').hide();"
                                         />
                    </h:panelGrid>
                </h:panelGrid>
            </h:form>
        </p:dialog>
        <p:dialog header="Workflow Progress"
                  widgetVar="workflowInfoDialog"
                  showEffect="fade"
                  hideEffect="fade"
                  modal="true"
                  width="600"
                  closable="true"
                  draggable="false"
                  resizable="false"
                  appendTo="@(body)">
            <h:form id="formWorkflowInfo">
                <!-- Job details in a structured grid -->
                <h:panelGrid style="margin:40px">

                    <h:panelGrid columns="2" 
                                 style="display: inline-block; border-collapse: separate; border-spacing: 0 10px;"> 
                        <h:panelGroup style="width:120px" layout="block">
                            <h:outputLabel value="Start Time:" style="font-weight:bold"/>
                        </h:panelGroup>

                        <h:outputText value="#{jobExecution.currentStartTime}" />

                        <h:outputLabel value="Job ID:" style="font-weight:bold" />
                        <h:outputText value="#{jobExecution.currentJobId}" />

                        <h:outputLabel value="Status:" style="font-weight:bold"/>
                        <h:panelGroup rendered="#{jobExecution.statusMsg == 'Job is running...'}">
                            <span>
                                <span id="statusText" style="color: green; font-weight:bold">Job is running</span>
                                <span class="dots">
                                    <span>.</span>
                                    <span>.</span>
                                    <span>.</span>
                                </span>
                            </span>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{jobExecution.statusMsg != 'Job is running...'}">
                            <h:outputText value="#{jobExecution.statusMsg}" escape="false" />
                        </h:panelGroup>
                    </h:panelGrid>

                    <h:panelGroup layout="block" style="margin-top:15px;">
                        <h:outputText value="Job submitted successfully. An email notice will be sent to you when your job is completed."/>
                    </h:panelGroup>

                    <h:panelGroup layout="block" style="margin-top:15px; font-weight:bold;">
                        <h:outputText value="Use the ‘Notice’ on the top menu bar to view all important system messages."/>
                    </h:panelGroup>

                </h:panelGrid>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
