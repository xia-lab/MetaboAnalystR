<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"

                xmlns:p="http://primefaces.org/ui">

    <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/resources/jscripts/pf.upload.js"></script>  

    <h:panelGrid style="text-align: center; width: 100%; padding:10px">
        <p:commandLink onclick="PF('uploadDialog').show()" >
            <span style="color: tomato;">
                <i class="pi pi-cloud-upload" style="color: tomato !important; font-size: 54px"/>
            </span>
            <div style="width: 100%; padding-top: 6px;">
                <p:outputLabel style="font-weight:bold; text-decoration: none!important" value="Data Upload"/>
            </div>
        </p:commandLink>
    </h:panelGrid>
    <p:dialog widgetVar="uploadDialog" dynamic="true" modal="true" appendTo="@(body)" header="Upload Your Data" 
              position="center center" onShow="PF('uploadDialog').initPosition()"
              hideEffect="explode" resizable="true">          

        <p:tabView widgetVar="tabWidget" id="ac" style="width:100%; border: none; font-size: 13px;" class="surface-card shadow-1 p-0 text-800">
            <p:tab title ="Upload">
                <h:form id="uploadform" enctype="multipart/form-data">

                    <div style="padding: 20px; line-height: 23px; width:630px;">
                        <p:remoteCommand name="validateFiles" actionListener="#{uploadBean.checkIntegrity}"/>
                        <div>
                            <p>
                                <b>Drag-and-drop</b> your data tables (max 10 files, maximum 200MB per file).  
                                Once the upload is completed, process them one by one use the table below.
                                Please make sure they share same meta-data groups (i.e. Control and Infected in each dataset).
                                You can also <b>Try Examples</b> on the bottom of the page. 
                            </p>
                        </div>
                        <p:fileUpload listener="#{uploader.handleFileUploadMulti}"
                                      sequential="true"
                                      update=":ac:uploadform"
                                      auto="false" 
                                      label="Choose" 
                                      mode="advanced" 
                                      style="width:600px; padding-top: 10px; line-height: 18px"
                                      multiple="true" 
                                      oncomplete="handleMultiFileUploadRequest(PF('importFile'), validateFiles);"
                                      widgetVar="importFile">
                            <p:validateFile sizeLimit="#{applicationBean1.FILE_SIZE_BYTE}"
                                            fileLimit="10"           
                                            allowTypes="/(\.|\/)(csv|txt|zip)$/"/>
                        </p:fileUpload>
                        <h3>Tips</h3>  	


                        <div>
                            Accept .csv or .txt tables with genes in rows and samples in columns. 
                            Make sure to add <b>#CLASS</b> to the first column of second row to specify group information.
                            Hover your mouse to the help icon for more info.                     
                            <p:graphicImage id="formatIcon" url="/resources/images/ui-help.png" alt="help"/> 
                        </div>
                        <p:tooltip for="formatIcon" styleClass="helpTip">
                            <b>Sample name, one class label (one missing value)</b>
                            <pre>
    #NAME	Sample1	Sample2	Sample3	Sample4	Sampl5	Sampl6	Sample7	Sample8
    #CLASS	case	case	case	case	control	control	control	control
    Gene1	-3.06	-2.25	-1.15	-6.64	0.4	1.08	1.22	1.02
    Gene2	-1.36	-0.67	-0.17	-0.97	-2.32	-5.06	0.28	1.32
    Gene3	1.61	-0.27	0.71	-0.62	0.14		0.11	0.98
    Gene4	0.93	1.29	-0.23	-0.74	-2	-1.25	1.07	1.27
                            </pre>

                        </p:tooltip>


                    </div>
                    <div style="text-align: center; width:600px; padding-bottom: 20px">
                        <p:commandButton value="Done!" onclick="PF('uploadDialog').hide()"/>
                    </div>
                </h:form>

            </p:tab>
            <p:tab title ="Google Drive">
                <h:form id="uploadform2" enctype="multipart/form-data">


                    <h:panelGrid style="padding: 20px; line-height: 23px; width:630px;">
                        <p>
                            MetaboAnalyst currently supports <u>mzML, mzXML, CDF or mzData formats in <b>centroid mode</b></u>. 
                            Quality control (QC) spectra are not required but recommended. 
                            QC should start with <b>"QC_"</b> or marked as "QC" in meta data. BLANK should be marked as "BLANK" in meta data for subtraction. 
                            For MS2 data, spectra should be acquired in either <b>DDA</b> or <b>SWATH-DIA</b> mode for each job. Mixed mode is not supported. 
                        </p>
                        <ul>
                            <li>
                                Please make sure the dataset you are sharing with us are open to the public or open to the <b>support@xialab.ca</b> with access as <b>Editor</b>.
                            </li>
                            <li>
                                All mzML/mzXML/mzData/CDF files must <b>NOT</b> be zipped. Metadata file must be exactly named as "metadata.txt", other files are automatically filtered. 
                            </li>
                            <li>
                                Include all spectra files directly in one folder. Using multiple-level sub-folders won't be identified.
                            </li>
                            <li>
                                The maximum size of raw spectra files for each job is 15.0GB. MS2 spectra file should not exceed 50. There is no limitation on the total number of files.
                            </li>
                            <li>
                                The sharing URL must be formatted like: <b>https://drive.google.com/drive/folders/somekeys?usp=drive_link</b>. Here is an <a href="https://drive.google.com/drive/folders/1kqvUQjPEiCEkGF297wlj2Tzeqmpg58wu?usp=drive_link" target="_blank">example</a> .Single file sharing (like https://drive.google.com/file/d/SOMEKEys/view?usp=drive_link) is not accepted.
                            </li>
                        </ul>
                        <h:panelGrid style="width: 520px; padding-top: 10px">
                            <p:outputLabel for="url" value="Google Drive URL: " style="font-size: 14px" />
                            <p:inputText id="url" value="#{specLoader.googledriveURL}" style="width: 750px; height: 40px"/>
                        </h:panelGrid>

                        <h:panelGrid style="width:520px; text-align:left; padding-top: 0px; padding-bottom: 5px;" columns="2">
                            <p:outputLabel style="font-weight: bold" value="Data Mode:"/>
                            <p:selectOneRadio value="#{spectraProcessor.ms2DataOpt}" id="msOpt2">
                                <f:selectItem itemLabel="MS1 Only" itemValue="ms1"/>
                                <f:selectItem itemLabel="MS1+DDA" itemValue="dda"/>
                                <f:selectItem itemLabel="MS1+SWATH-DIA" itemValue="swath"/>
                                <p:ajax event="change" listener="#{specLoader.updateMS2status()}" update=":ac:uploadform2:msOpt2"/>
                            </p:selectOneRadio>
                        </h:panelGrid>
                    </h:panelGrid>
                    <h:panelGrid style="width:520px; padding: 10px; text-align: center; margin-left: 13px" columns="2">
                        <p:commandButton value="Submit" 
                                         style="width:100px; height: 35px;"
                                         id="signinBn"
                                         onclick="PF('statusDialog').show();"
                                         action="#{specLoader.confirmSeqURL()}"
                                         update="procBn2" 
                                         disabled="#{specLoader.allowGoogleDriveContinue}"
                                         icon="pi pi-sign-in"
                                         oncomplete ="PF('statusDialog').hide();"/>
                        <p:commandButton value="Proceed" id="procBn2"
                                         style="width:100px"
                                         onclick="PF('statusDialog').show()"
                                         oncomplete="PF('statusDialog').hide()"
                                         ajax="false" 
                                         disabled="#{!specLoader.allowGoogleDriveContinue}"
                                         action="#{specLoader.processSaintyCheck()}"/>  
                    </h:panelGrid>
                </h:form>

            </p:tab>
        </p:tabView>
    </p:dialog>
</ui:composition>

